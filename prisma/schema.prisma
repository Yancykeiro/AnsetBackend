// Prisma Schema - 数据库模型定义

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // 或 "mysql"
  url      = env("DATABASE_URL")
}

// 用户表
model User {
  id        String   @id @default(cuid())
  openId    String   @unique // 微信小程序 openId
  nickName  String?
  avatarUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  reports   Report[]
}

// 改造报告
model Report {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  roomType    String   // 房间类型：卫生间、厨房等
  budgetRange String   // 预算范围
  
  status      String   @default("processing") // processing, completed, failed
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  images      Image[]
  survey      Survey?
  analysis    Analysis?
}

// 图片表
model Image {
  id        String   @id @default(cuid())
  reportId  String
  report    Report   @relation(fields: [reportId], references: [id])
  
  url       String   // 图片存储路径
  order     Int      // 图片顺序
  
  createdAt DateTime @default(now())
}

// 问卷表
model Survey {
  id        String   @id @default(cuid())
  reportId  String   @unique
  report    Report   @relation(fields: [reportId], references: [id])
  
  // 问卷字段（根据你的实际需求调整）
  style     String?  // 喜欢的风格
  problems  String?  // 主要问题
  priority  String?  // 优先级
  
  answers   Json?    // 存储其他问卷答案的 JSON 对象
  
  createdAt DateTime @default(now())
}

// AI 分析结果表
model Analysis {
  id        String   @id @default(cuid())
  reportId  String   @unique
  report    Report   @relation(fields: [reportId], references: [id])
  
  // AI 分析结果
  summary       String   @db.Text // 总结
  problems      String   @db.Text // 发现的问题
  suggestions   String   @db.Text // 改造建议
  materials     String?  @db.Text // 建议材料
  estimatedCost String?           // 预估费用
  
  rawResponse   Json?    // 保存 AI 原始响应
  
  createdAt     DateTime @default(now())
}
